### JWT・リフレッシュトークンに係る仕様について

#### JWT・リフレッシュトークン利用の目的
JWTを用いることでステートレスのサービスでも高度なセキュリティを実現できる。
また設定ファイルに記述するのみで認証に有効期限を設けることが可能。
JWTに加えリフレッシュトークンを導入することでさらにセキュリティが強化されるため
本アプリではリフレッシュトークンも併せて使用している。

#### 本アプリでのJWT・リフレッシュトークンの仕様
JWTは一般的にユーザデータ（ユーザ名など）とサーバで保持するシークレットキーをもとに
指定するアルゴリズムでハッシュ化して生成される。
本アプリではハッシュアルゴリズムにHmacSHA256を使用している。

REST APIでユーザログイン時にJWTとリフレッシュトークンを生成し、それぞれレスポンスのクッキーに設定する。
その後フロントエンドからのリクエストにはJWTがクッキーに設定されており
認証済みの場合しかアクセスできなリソースへのリクエストの際はセキュリティフィルタで
JWTの検証が行われ、JWTが有効の場合リクエストを正常に処理し、無効の際はエラーレスポンスを返却する。
JWTの有効期限切れのため無効となる場合はカスタムステータス420を返却する。

フロントエンドでステータス420を受けた際は、JWTを再生成するリクエストを発行し、
その際、リクエストクッキーにリフレッシュトークンを含める。

REST APIでリフレッシュトークンを検証し有効期限内であれば、
JWTを再生成して返却（本アプリではこの際リフレッシュトークンの期限は延長しない）、
リフレッシュトークンが期限切れであれば、ユーザをログアウトし、エラーレスポンスを返却する。
ユーザがサービスの使用を継続したい場合は再度ログインが必要となる。

本アプリではJWTの有効期限を10分、リフレッシュトークンの有効期限を24時間と設定している。

#### 上記処理を定義するクラス
- AuthTokenFilter.java
パッケージ：com.restapi.ecommerce.security.jwt
メソッドdoFilterInternalで、リクエストのクッキーからJWTを抽出、検証し、有効であれば、
UserDetailsServiceのメソッドloadUserByUsernameよりユーザ情報を取得し、
権限などのデータをセキュリティコンテキストに設定する。

- AuthEntryPointJwt.java
パッケージ：com.restapi.ecommerce.security.jwt
フィルターチェーンで例外が発生した際のレスポンス設定処理を定義している。
エラーレスポンスがCORSを回避してフロントエンドに届くようヘッダに下記を設定。
  Access-Control-Allow-Credentials: true
  Access-Control-Allow-Origin: (フロントエンドURL)

JWTの有効期限切れで例外が発生した際はカスタムステータス420を設定する。
そのほかの場合はステータス401 Unauthorizedを設定する。

- WebSecurityConfig.java
パッケージ：com.restapi.ecommerce.security
UsernamePasswordAuthenticationFilterの前にAuthTokenFilterを挿入している。
